export const HOLIDAYS = [
    // 2025
    { date: '2025-01-01', name: 'Confraterniza√ß√£o Universal', type: 'feriado' },
    { date: '2025-02-14', name: 'Valentine\'s Day', type: 'comemorativo', important: true },
    { date: '2025-03-04', name: 'Carnaval', type: 'feriado' },
    { date: '2025-03-08', name: 'Dia da Mulher', type: 'comemorativo', important: true },
    { date: '2025-03-15', name: 'Dia do Consumidor', type: 'comemorativo', important: true },
    { date: '2025-04-18', name: 'Sexta-feira Santa', type: 'feriado' },
    { date: '2025-04-20', name: 'P√°scoa', type: 'comemorativo', important: true },
    { date: '2025-04-21', name: 'Tiradentes', type: 'feriado' },
    { date: '2025-04-28', name: 'Dia do Frete Gr√°tis', type: 'comemorativo', important: true },
    { date: '2025-05-01', name: 'Dia do Trabalho', type: 'feriado' },
    { date: '2025-05-11', name: 'Dia das M√£es', type: 'comemorativo', important: true },
    { date: '2025-06-12', name: 'Dia dos Namorados', type: 'comemorativo', important: true },
    { date: '2025-06-19', name: 'Corpus Christi', type: 'feriado' },
    { date: '2025-07-26', name: 'Dia dos Av√≥s', type: 'comemorativo', important: true },
    { date: '2025-08-10', name: 'Dia dos Pais', type: 'comemorativo', important: true },
    { date: '2025-09-07', name: 'Independ√™ncia do Brasil', type: 'feriado' },
    { date: '2025-09-15', name: 'Dia do Cliente', type: 'comemorativo', important: true },
    { date: '2025-10-12', name: 'Nossa Sra. Aparecida / Dia das Crian√ßas', type: 'feriado', important: true },
    { date: '2025-10-31', name: 'Halloween', type: 'comemorativo' },
    { date: '2025-11-02', name: 'Finados', type: 'feriado' },
    { date: '2025-11-11', name: 'Dia do Solteiro (11.11)', type: 'comemorativo', important: true },
    { date: '2025-11-15', name: 'Proclama√ß√£o da Rep√∫blica', type: 'feriado' },
    { date: '2025-11-20', name: 'Dia da Consci√™ncia Negra', type: 'feriado' },
    { date: '2025-11-28', name: 'Black Friday', type: 'comemorativo', important: true },
    { date: '2025-12-01', name: 'Cyber Monday', type: 'comemorativo', important: true },
    { date: '2025-12-25', name: 'Natal', type: 'feriado', important: true },

    // 2026
    { date: '2026-01-01', name: 'Confraterniza√ß√£o Universal', type: 'feriado' },
    { date: '2026-02-14', name: 'Valentine\'s Day', type: 'comemorativo', important: true },
    { date: '2026-02-17', name: 'Carnaval', type: 'feriado' },
    { date: '2026-03-08', name: 'Dia da Mulher', type: 'comemorativo', important: true },
    { date: '2026-03-15', name: 'Dia do Consumidor', type: 'comemorativo', important: true },
    { date: '2026-04-03', name: 'Sexta-feira Santa', type: 'feriado' },
    { date: '2026-04-05', name: 'P√°scoa', type: 'comemorativo', important: true },
    { date: '2026-04-21', name: 'Tiradentes', type: 'feriado' },
    { date: '2026-04-28', name: 'Dia do Frete Gr√°tis', type: 'comemorativo', important: true },
    { date: '2026-05-01', name: 'Dia do Trabalho', type: 'feriado' },
    { date: '2026-05-10', name: 'Dia das M√£es', type: 'comemorativo', important: true },
    { date: '2026-06-04', name: 'Corpus Christi', type: 'feriado' },
    { date: '2026-06-12', name: 'Dia dos Namorados', type: 'comemorativo', important: true },
    { date: '2026-07-26', name: 'Dia dos Av√≥s', type: 'comemorativo', important: true },
    { date: '2026-08-09', name: 'Dia dos Pais', type: 'comemorativo', important: true },
    { date: '2026-09-07', name: 'Independ√™ncia do Brasil', type: 'feriado' },
    { date: '2026-09-15', name: 'Dia do Cliente', type: 'comemorativo', important: true },
    { date: '2026-10-12', name: 'Nossa Sra. Aparecida / Dia das Crian√ßas', type: 'feriado', important: true },
    { date: '2026-10-31', name: 'Halloween', type: 'comemorativo' },
    { date: '2026-11-02', name: 'Finados', type: 'feriado' },
    { date: '2026-11-11', name: 'Dia do Solteiro (11.11)', type: 'comemorativo', important: true },
    { date: '2026-11-15', name: 'Proclama√ß√£o da Rep√∫blica', type: 'feriado' },
    { date: '2026-11-20', name: 'Dia da Consci√™ncia Negra', type: 'feriado' },
    { date: '2026-11-27', name: 'Black Friday', type: 'comemorativo', important: true },
    { date: '2026-11-30', name: 'Cyber Monday', type: 'comemorativo', important: true },
    { date: '2026-12-25', name: 'Natal', type: 'feriado', important: true },

    // 2027
    { date: '2027-01-01', name: 'Confraterniza√ß√£o Universal', type: 'feriado' },
    { date: '2027-02-09', name: 'Carnaval', type: 'feriado' },
    { date: '2027-02-14', name: 'Valentine\'s Day', type: 'comemorativo', important: true },
    { date: '2027-03-08', name: 'Dia da Mulher', type: 'comemorativo', important: true },
    { date: '2027-03-15', name: 'Dia do Consumidor', type: 'comemorativo', important: true },
    { date: '2027-03-26', name: 'Sexta-feira Santa', type: 'feriado' },
    { date: '2027-03-28', name: 'P√°scoa', type: 'comemorativo', important: true },
    { date: '2027-04-21', name: 'Tiradentes', type: 'feriado' },
    { date: '2027-04-28', name: 'Dia do Frete Gr√°tis', type: 'comemorativo', important: true },
    { date: '2027-05-01', name: 'Dia do Trabalho', type: 'feriado' },
    { date: '2027-05-09', name: 'Dia das M√£es', type: 'comemorativo', important: true },
    { date: '2027-05-27', name: 'Corpus Christi', type: 'feriado' },
    { date: '2027-06-12', name: 'Dia dos Namorados', type: 'comemorativo', important: true },
    { date: '2027-07-26', name: 'Dia dos Av√≥s', type: 'comemorativo' },
    { date: '2027-08-08', name: 'Dia dos Pais', type: 'comemorativo', important: true },
    { date: '2027-09-07', name: 'Independ√™ncia do Brasil', type: 'feriado' },
    { date: '2027-09-15', name: 'Dia do Cliente', type: 'comemorativo', important: true },
    { date: '2027-10-12', name: 'Nossa Sra. Aparecida / Dia das Crian√ßas', type: 'feriado', important: true },
    { date: '2027-10-31', name: 'Halloween', type: 'comemorativo' },
    { date: '2027-11-02', name: 'Finados', type: 'feriado' },
    { date: '2027-11-11', name: 'Dia do Solteiro (11.11)', type: 'comemorativo', important: true },
    { date: '2027-11-15', name: 'Proclama√ß√£o da Rep√∫blica', type: 'feriado' },
    { date: '2027-11-20', name: 'Dia da Consci√™ncia Negra', type: 'feriado' },
    { date: '2027-11-26', name: 'Black Friday', type: 'comemorativo', important: true },
    { date: '2027-11-29', name: 'Cyber Monday', type: 'comemorativo', important: true },
    { date: '2027-12-25', name: 'Natal', type: 'feriado', important: true },
];

interface ScoreResult {
    score: number;
    reasons: string[];
    tips: string[];
    nearbyEvent?: string;
    isHoliday?: boolean;
}

export function calculateDateScore(date: Date): ScoreResult {
    let score = 50; // Base score
    // Collect factors independently. 
    // Positive factors ONLY used if score >= 60.
    // Negative factors ONLY used if score < 60.
    const positiveFactors: string[] = [];
    const negativeFactors: string[] = [];
    const tips: string[] = [];
    let nearbyEvent: string | undefined;

    const day = date.getDate();
    const month = date.getMonth(); // 0-11
    const dayOfWeek = date.getDay(); // 0-6 (Sun-Sat)
    const dateString = date.toISOString().split('T')[0];

    // --- 1. L√≥gica de Dia da Semana ---
    if (dayOfWeek === 0) { // Domingo
        score += 25;
        if (day <= 10) positiveFactors.push('Domingo de Sal√°rio: O melhor dia do m√™s para vendas online');
        else positiveFactors.push('Domingo: Clientes em casa com maior tempo de tela');
    } else if (dayOfWeek === 6) { // S√°bado
        score += 20;
        if (day >= 5 && day <= 15) positiveFactors.push('S√°bado de Compras: Dia tradicional de com√©rcio aquecido');
        else positiveFactors.push('S√°bado: Maior disponibilidade para navegar');
    } else if (dayOfWeek === 5) { // Sexta
        score += 15;
        positiveFactors.push('Sexta-feira: Clima de "Sextou" estimula auto-presentes');
    } else if (dayOfWeek === 1) { // Segunda
        score -= 10;
        negativeFactors.push('Segunda-feira: Foco no trabalho reduz aten√ß√£o a compras');
    } else {
        // Meio de semana - Neutro/Negativo leve
        if (score < 60) negativeFactors.push('Dia de rotina (Meio de semana): Consumo por impulso √© menor');
    }

    // --- 2. L√≥gica de Pagamento (Fator Cr√≠tico) ---
    if ((day >= 1 && day <= 10) || day >= 28) {
        score += 35;
        positiveFactors.push('Semana de Pagamento: Poder de compra no auge');
        tips.push('Lance suas pe√ßas de maior valor agora!');
    } else if (day >= 14 && day <= 16) {
        score += 15;
        positiveFactors.push('Dia 15: Adiantamento salarial movimenta o mercado');
    } else if (day > 18 && day < 28) {
        // Penalty for end of month
        score -= 25;
        negativeFactors.push('Fim de M√™s: Or√ßamento das fam√≠lias comprometido');
        tips.push('Aposte em promo√ß√µes agressivas ou frete gr√°tis');
    }

    // --- 3. L√≥gica de Feriados/Eventos ---
    const exactHoliday = HOLIDAYS.find(h => h.date === dateString);
    if (exactHoliday) {
        if (exactHoliday.important) {
            score += 20;
            nearbyEvent = exactHoliday.name;
            positiveFactors.push(`üî• Grande Data: ${exactHoliday.name}`);
        } else {
            score -= 30; // Strong penalty for generic holidays
            negativeFactors.push(`Feriado (${exactHoliday.name}): Risco de viagens e desconex√£o`);
            tips.push('Antecipe o bazar para garantir entregas');
            // If it's a holiday penalty, we might force return or handle normally
            // Let's allow math to decide, but this is a strong negative.
        }
    }

    // Janela de Prepara√ß√£o (Positivo)
    for (const holiday of HOLIDAYS) {
        if (!holiday.important) continue;

        const dTime = new Date(dateString).getTime();
        const hTime = new Date(holiday.date).getTime();
        const diffDays = Math.ceil((hTime - dTime) / (1000 * 60 * 60 * 24));

        if (diffDays > 0 && diffDays <= 20) {
            if (diffDays <= 7) {
                score += 30;
                nearbyEvent = `Pr√©-${holiday.name}`;
                positiveFactors.push(`Urg√™ncia para ${holiday.name}: Alta demanda por presentes`);
                tips.push(`Ofere√ßa entrega expressa para o ${holiday.name}`);
            } else if (diffDays <= 14) {
                score += 15;
                nearbyEvent = `Vem a√≠: ${holiday.name}`;
                positiveFactors.push(`Aquecimento ${holiday.name}: Pesquisas iniciadas`);
            }
        }
    }

    // --- 4. Ajustes Sazonais (Negativos) ---
    if (month === 0) {
        if (day < 15) {
            score -= 15;
            negativeFactors.push('Ressaca de Janeiro: Gastos extras (IPVA/IPTU/Escola)');
        }
    }

    if (month === 2 && day < 5) {
        score -= 10;
        negativeFactors.push('Retomada p√≥s-Carnaval ainda lenta');
    }

    // --- Normaliza√ß√£o do Score ---
    score = Math.max(0, Math.min(100, score));

    // --- STRICT FILTERING LOGIC ---
    let displayReasons: string[] = [];

    if (score >= 60) {
        // GOOD/EXCELLENT DATE
        // Show ONLY positive factors. Hide any negatives (even if they exist).
        displayReasons = [...positiveFactors];

        // Fallback generic positive if empty but score is high (rare)
        if (displayReasons.length === 0) {
            displayReasons.push('Data estrat√©gica com alto potencial de vendas');
        }
    } else {
        // BAD/RISKY DATE
        // Show ONLY negative factors. Hide any positives (even if Saturday/Payday helped slightly).
        displayReasons = [...negativeFactors];

        // Fallback generic negative if empty (rare)
        if (displayReasons.length === 0) {
            displayReasons.push('Data com baixo volume hist√≥rico de convers√£o');
        }
    }

    return {
        score,
        // Limit to top 3 to keep UI clean
        reasons: [...new Set(displayReasons)].slice(0, 3),
        tips: [...new Set(tips)],
        nearbyEvent
    };
}
